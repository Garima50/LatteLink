<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <title>Shopping Cart</title>
    <link rel="stylesheet" href="/css/cart.css">
    <!-- <link rel="stylesheet" href="css/header.css"> -->
     <style>
      /*
I wanted to go with a mobile first approach, but it actually lead to more verbose CSS in this case, so I've gone web first. Can't always force things...

Side note: I know that this style of nesting in SASS doesn't result in the most performance efficient CSS code... but on the OCD/organizational side, I like it. So for CodePen purposes, CSS selector performance be damned.
*/
/* Global settings */
/* Global "table" column settings */

/* Adjust widths to accommodate the new "Size" column */
.product-image {
    float: left;
    width: 15%;
}

.product-details {
    float: left;
    width: 30%;
}

.product-size { /* New Size Column */
    float: left;
    width: 10%;
}

.product-price {
    float: left;
    width: 10%;
}

.product-quantity {
    float: left;
    width: 10%;
}

.product-removal {
    float: left;
    width: 9%;
}

.product-line-price {
    float: left;
    width: 12%;
    text-align: right;
}

.product-size select {
    width: 100%;
    padding: 5px;
    font-size: 12px;
}

.product .product-size select {
    width: auto;
    padding: 4px;
    font-family: "HelveticaNeue-Medium", "Helvetica Neue Medium";
}

.product .product-size select:hover {
    background-color: #eee;
}

/* Adjust media queries */
@media screen and (max-width: 650px) {
  .product-size {
    width: auto;
    margin-bottom: 10px;
  }
}


/* .product-image {
    float: left;
    width: 20%;
  }
  
  .product-details {
    float: left;
    width: 37%;
  }
  
  .product-price {
    float: left;
    width: 12%;
  }
  
  .product-quantity {
    float: left;
    width: 10%;
  }
  
  .product-removal {
    float: left;
    width: 9%;
  }
  
  .product-line-price {
    float: left;
    width: 12%;
    text-align: right;
  } */
  
  /* This is used as the traditional .clearfix class */
  .group:before, .shopping-cart:before, .column-labels:before, .product:before, .totals-item:before,
  .group:after,
  .shopping-cart:after,
  .column-labels:after,
  .product:after,
  .totals-item:after {
    content: '';
    display: table;
  }
  
  .group:after, .shopping-cart:after, .column-labels:after, .product:after, .totals-item:after {
    clear: both;
  }
  
  .group, .shopping-cart, .column-labels, .product, .totals-item {
    zoom: 1;
  }
  
  /* Apply clearfix in a few places */
  /* Apply dollar signs */
  .product .product-price:before, .product .product-line-price:before, .totals-value:before {
    content: '$';
  }
  
  /* Body/Header stuff */
  body {
    padding: 0px 30px 30px 20px;
    font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, sans-serif;
    font-weight: 100;
  }
  
  h1 {
    font-weight: 100;
  }
  
  label {
    color: #aaa;
  }
  
  .shopping-cart {
    margin-top: -45px;
  }
  
  /* Column headers */
  .column-labels label {
    padding-bottom: 15px;
    margin-bottom: 15px;
    border-bottom: 1px solid #eee;
  }
  .column-labels .product-image, .column-labels .product-details, .column-labels .product-removal {
    text-indent: -9999px;
  }
  
  /* Product entries */
  .product {
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 1px solid #eee;
  }
  .product .product-image {
    text-align: center;
  }
  .product .product-image img {
    width: 100px;
  }
  .product .product-details .product-title {
    margin-right: 20px;
    font-family: "HelveticaNeue-Medium", "Helvetica Neue Medium";
  }
  .product .product-details .product-description {
    margin: 5px 20px 5px 0;
    line-height: 1.4em;
  }
  .product .product-quantity input {
    width: 40px;
  }
  .product .remove-product {
    border: 0;
    padding: 4px 8px;
    background-color: rgb(88, 88, 88);
    color: #fff;
    font-family: "HelveticaNeue-Medium", "Helvetica Neue Medium";
    font-size: 12px;
    border-radius: 3px;
  }
  .product .remove-product:hover {
    background-color: rgb(66, 66, 66);
  }
  
  /* Totals section */
  .totals .totals-item {
    float: right;
    clear: both;
    width: 100%;
    margin-bottom: 10px;
  }
  .totals .totals-item label {
    float: left;
    clear: both;
    width: 79%;
    text-align: right;
  }
  .totals .totals-item .totals-value {
    float: right;
    width: 21%;
    text-align: right;
  }
  /* .totals .totals-item-total {
    font-family: "HelveticaNeue-Medium", "Helvetica Neue Medium";
  } */
  
  .checkout {
    float: right;
    border: 0;
    margin-top: 20px;
    padding: 6px 25px;
    background-color: rgb(0, 0, 0);
    color: #fff;
    font-size: 25px;
    border-radius: 3px;
  }
  
  .checkout:hover {
    background-color: rgb(89, 89, 89);
  }
  
  /* Make adjustments for tablet */
  @media screen and (max-width: 650px) {
    .shopping-cart {
      margin: 0;
      padding-top: 20px;
      border-top: 1px solid #eee;
    }
  
    .column-labels {
      display: none;
    }
  
    .product-image {
      float: right;
      width: auto;
    }
    .product-image img {
      margin: 0 0 10px 10px;
    }
  
    .product-details {
      float: none;
      margin-bottom: 10px;
      width: auto;
    }
  
    .product-price {
      clear: both;
      width: 70px;
    }
  
    .product-quantity {
      width: 100px;
    }
    .product-quantity input {
      margin-left: 20px;
    }
  
    .product-quantity:before {
      content: 'x';
    }
  
    .product-removal {
      width: auto;
    }
  
    .product-line-price {
      float: right;
      width: 70px;
    }
  }
  /* Make more adjustments for phone */
  @media screen and (max-width: 350px) {
    .product-removal {
      float: right;
    }
  
    .product-line-price {
      float: right;
      clear: left;
      width: auto;
      margin-top: 10px;
    }
  
    .product .product-line-price:before {
      content: 'Item Total: $';
    }
  
    .totals .totals-item label {
      width: 60%;
    }
    .totals .totals-item .totals-value {
      width: 40%;
    }
  }
  
  /* Modal styles */
.modal {
    display: none; 
    position: fixed; 
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100%; 
    background-color: rgba(0, 0, 0, 0.5);
    justify-content: center; 
    align-items: center; 
  }
  
  .modal-content {
    background-color: white;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    width: 300px;
  }
  
  .payment-options {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-bottom: 20px;
  }
  
  .payment-option {
    display: flex;
    align-items: center;
    cursor: pointer;
  }
  
  .payment-option img {
    width: 30px;
    margin-right: 10px;
  }
  
  /* Disabled state for continue button */
  #continue-button[disabled] {
    background-color: #ccc;
    cursor: not-allowed;
  }
  
  #continue-button {
    background-color: #000000;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }

  #continue-button:hover {
    background-color: rgb(66, 66, 66);
  }

/* Loader styles */
.loader1 {
    background-color: black;
    border: 8px solid #f3f3f3; /* Light grey background */
    border-top: 8px solid #3498db; /* Blue colored top border for spinner effect */
    border-radius: 50%;  /* Make it circular */
    width: 60px;  /* Adjust size */
    height: 60px;
    animation: 1s spin linear infinite;  /* Continuous spinning animation */
    margin: 20px auto;  /* Center the loader inside the modal */
  }
  
  /* Keyframe animation for spin effect */
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  .payment-options {
    margin-top: 20px;
}



/* Responsive Adjustments */
@media (max-width: 1200px) {
.header-content {
    flex-direction: column;
    align-items: flex-start;
}

.user-options {
    margin-top: 15px;
}
}

@media (max-width: 992px) {
.header-content {
    padding: 0 10px;
}

.navli {
    flex-direction: column;
}

.navli .nav-item {
    margin-bottom: 10px;
}

.product-container {
    flex-direction: column;
}
}

@media (max-width: 768px) {
.product-images img#productImg {
    padding: 20px 0;
}

.product-details .p1 {
    font-size: 22px;
}

.product-details .p2 {
    font-size: 15px;
}
}

@media (max-width: 576px) {
.topdiv {
    font-size: 0.6em;
}

.header-content {
    padding: 0 5px;
}

.logo h1 {
    font-size: 1.8em;
}

.user-options .wishlist,
.user-options .shop {
    font-size: 20px;
}

.product-images img#productImg {
    padding: 10px 0;
}
}

     </style>
</head>
<body>

 <br> <br>

<h1>Shopping Cart</h1>

<div class="shopping-cart">

  <div class="column-labels">
    <label class="product-image">Image</label>
    <label class="product-details">Product</label>
    <label class="product-size">Size</label> <!-- New Size Label -->
    <label class="product-price">Price</label>
    <label class="product-quantity">Quantity</label>
    <label class="product-removal">Remove</label>
    <label class="product-line-price">Total</label>
  </div>

  <div class="product" data-price="12795">
    <div class="product-image">
      <img src="/img/vienna.jpg">
    </div>
    <div class="product-details">
      <div class="product-title">Vienna Coffee</div>
      <p class="product-description">The Air Max 90 LV8 takes your favourite silhouette to the next level with stacked Nike Air units.</p>
    </div>
    <div class="product-size"> <!-- New Size Dropdown -->
      <select>
        <option value="Small">Small</option>
        <option value="Medium">Medium</option>
        <option value="Medium">Large</option>
      </select>
    </div>
    <div class="product-price">400</div>
    <div class="product-quantity">
      <input type="number" value="2" min="1">
    </div>
    <div class="product-removal">
      <button class="remove-product">
        Remove
      </button>
    </div>
    <div class="product-line-price">25 590</div>
  </div>

  <div class="product" data-price="71817">
    <div class="product-image">
      <img src="img/vanillacupcake.jpg">
    </div>
    <div class="product-details">
      <div class="product-title">Vanilla Cupcakes</div>
      <p class="product-description">The Vanilla elevates the classic pump with a contemporary drop heel and square-cut vamp.</p>
    </div>
    <div class="product-size"> <!-- New Size Dropdown -->
      <select>
        <option value="Small">Small</option>
        <option value="Medium">Medium</option>
        <option value="Medium">Large</option>
      </select>
    </div>
    <div class="product-price">350</div>
    <div class="product-quantity">
      <input type="number" value="1" min="1">
    </div>
    <div class="product-removal">
      <button class="remove-product">
        Remove
      </button>
    </div>
    <div class="product-line-price">350</div>
  </div>

  <div class="totals">
    <div class="totals-item">
      <label>Subtotal</label>
      <div class="totals-value" id="cart-subtotal">750</div>
    </div>
    <div class="totals-item">
      <label>Tax (5%)</label>
      <div class="totals-value" id="cart-tax">15</div>
    </div>
    <div class="totals-item">
      <label>Shipping</label>
      <div class="totals-value" id="cart-shipping">00.00</div>
    </div>
    <div class="totals-item totals-item-total">
      <label>Grand Total</label>
      <div class="totals-value" id="cart-total">765</div>
    </div>
  </div>
      
  <button class="checkout">Checkout</button>

</div>

<!-- Payment Modal -->
<div id="payment-modal" class="modal">
    <div class="modal-content">
      <h2>Select Payment Method</h2>

       <!-- Loader, initially hidden -->
       <div id="loader" class="loader1" style="display: none;"></div>
       
      <div class="payment-options">
        <label class="payment-option">
          <input type="radio" name="payment" value="net-banking">
          <img src="img/netb.jpg" alt="Net Banking"> Net Banking
        </label>
        <label class="payment-option">
          <input type="radio" name="payment" value="google-pay">
          <img src="img/gpay.png" alt="Google Pay"> Google Pay
        </label>
        <label class="payment-option">
          <input type="radio" name="payment" value="upi">
          <img src="img/upi.jpg" alt="UPI"> UPI
        </label>
        <label class="payment-option">
          <input type="radio" name="payment" value="cod">
          <img src="img/cod.png" alt="Cash on Delivery"> Cash on Delivery
        </label>
      </div>
      <button id="continue-button" disabled>Continue</button>
    </div>
  </div>

  <br> <br> <br> <br>
  

<!-- Add jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Your custom script -->
<script>

  /* Set rates + misc */
var taxRate = 0.05; // Tax rate
var shippingRate = 0.00; // Shipping rate
var fadeTime = 300; // Fade time for animations

/* Assign actions */
$('.product-quantity input').change(function() {
  updateQuantity(this); // Update quantity when changed
});

$('.product-removal button').click(function() {
  removeItem(this); // Remove item from cart
});

/* Recalculate cart */
function recalculateCart() {
  var subtotal = 0;

  /* Sum up row totals */
  $('.product').each(function() {
    // Get the line price as a float number without any currency symbols
    var linePrice = parseFloat($(this).find('.product-line-price').text().replace(/,/g, '').trim());
    subtotal += linePrice; // Add to subtotal
  });

  /* Calculate totals */
  var tax = subtotal * taxRate; // Calculate tax
  var shipping = (subtotal > 0 ? shippingRate : 0); // Determine shipping cost
  var total = subtotal + tax + shipping; // Calculate total

  /* Update totals display */
  $('.totals-value').fadeOut(fadeTime, function() {
    // Display values with the "â‚¹" symbol, formatted for Indian currency
    $('#cart-subtotal').html(subtotal.toLocaleString("en-IN", { minimumFractionDigits: 2 }));
    $('#cart-tax').html(tax.toLocaleString("en-IN", { minimumFractionDigits: 2 }));
    $('#cart-shipping').html(shipping.toLocaleString("en-IN", { minimumFractionDigits: 2 }));
    $('#cart-total').html(total.toLocaleString("en-IN", { minimumFractionDigits: 2 }));

    // Show or hide checkout button based on total
    if (total === 0) {
      $('.checkout').fadeOut(fadeTime);
    } else {
      $('.checkout').fadeIn(fadeTime);
    }
    $('.totals-value').fadeIn(fadeTime); // Show updated totals
  });
}

/* Update quantity */
function updateQuantity(quantityInput) {
  var productRow = $(quantityInput).closest('.product'); // Get the product row
  var price = parseFloat(productRow.data('price')); // Fetch price from data attribute
  var quantity = parseFloat($(quantityInput).val()); // Get quantity value
  var linePrice = price * quantity; // Calculate line price

  /* Update line price display and recalculate cart totals */
  productRow.find('.product-line-price').each(function() {
    $(this).fadeOut(fadeTime, function() {
      $(this).text(linePrice.toLocaleString("en-IN", { minimumFractionDigits: 2 })); // Display formatted line price
      recalculateCart(); // Recalculate cart totals
      $(this).fadeIn(fadeTime); // Show updated line price
    });
  });
}

/* Remove item from cart */
function removeItem(removeButton) {
  var productRow = $(removeButton).closest('.product'); // Get the product row
  productRow.slideUp(fadeTime, function() {
    productRow.remove(); // Remove product from the DOM
    recalculateCart(); // Recalculate totals
  });
}



// Get modal and button elements
var modal = document.getElementById('payment-modal');
var checkoutButton = document.querySelector('.checkout');
var continueButton = document.getElementById('continue-button');
var paymentOptions = document.querySelectorAll('input[name="payment"]');
var loader = document.getElementById('loader');  // Get the loader element

// Show modal when checkout button is clicked
checkoutButton.addEventListener('click', async function() {
    loader.style.display = 'block';  // Show the loader while fetching payment methods

    // Asynchronously fetch available payment methods
    await fetchPaymentMethods();

    loader.style.display = 'none';  // Hide the loader after fetching
    modal.style.display = 'flex';  // Show the modal
});

// Continue button click event
continueButton.addEventListener('click', async function() {
    if (!continueButton.disabled) {
        loader.style.display = 'block'; // Show the loader during payment processing
        modal.style.display = 'none'; // Hide the modal
        
        // Fetch and process the selected payment asynchronously
        var selectedPayment = document.querySelector('input[name="payment"]:checked').value;
        
        try {
            await processPayment(selectedPayment);  // Async payment processing
            loader.style.display = 'none';  // Hide loader after processing
            // Redirect after successful payment processing
            window.location.href = 'thanks.html';  // Thank you/confirmation page
        } catch (error) {
            loader.style.display = 'none';  // Hide loader in case of error
            console.error("Payment failed: ", error);
            alert('Payment failed, please try again.');
        }
    }
});

// Enable continue button only after a payment option is selected
paymentOptions.forEach(function(option) {
    option.addEventListener('change', function() {
        continueButton.disabled = false;  // Enable continue button
    });
});

// Function to simulate asynchronous fetching of payment methods (e.g., from an API)
async function fetchPaymentMethods() {
    return new Promise((resolve) => {
        setTimeout(() => {
            console.log('Fetched payment methods'); 
            resolve();
        }, 1000); // Simulate 1 second API fetch time
    });
}

// Function to simulate asynchronous payment processing
async function processPayment(paymentMethod) {
    return new Promise((resolve, reject) => {
        setTimeout(() => {
            if (paymentMethod) {
                console.log(`Payment processed via ${paymentMethod}`);
                resolve();  // Resolve the promise to simulate successful payment
            } else {
                reject('No payment method selected');  // Reject in case of failure
            }
        }, 2000); // Simulate 2 second payment processing time
    });
}

</script>

</body>
</html>
